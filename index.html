<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Ù„Ø¹Ø¨Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„ØªØ¹Ù„Ù… Ù‚ÙˆØ§Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£Ù„Ù ÙÙŠ Ø§Ù„Ø£ÙØ¹Ø§Ù„ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">
  <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ù„Ù ÙÙŠ Ø¢Ø®Ø± Ø§Ù„Ø£ÙØ¹Ø§Ù„</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- SDK -->
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  
  <!-- Ø®Ø·ÙˆØ· -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
  
  <!-- Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø­Ø³Ù†Ø© -->
  <style>
    :root {
      --primary: #4f46e5;
      --secondary: #7c3aed;
      --accent: #f59e0b;
      --success: #10b981;
      --danger: #ef4444;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Tajawal', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* Animations */
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-20px); }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    @keyframes celebrate {
      0% { transform: scale(1) rotate(0deg); opacity: 0; }
      50% { transform: scale(1.2) rotate(10deg); opacity: 1; }
      100% { transform: scale(1) rotate(0deg); opacity: 0; }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    /* Utility Classes */
    .animate-slide-in { animation: slideIn 0.4s ease-out; }
    .animate-slide-out { animation: slideOut 0.4s ease-out; }
    .animate-pulse-custom { animation: pulse 0.3s ease-out; }
    .animate-shake { animation: shake 0.5s ease-out; }
    .animate-celebrate { animation: celebrate 0.6s ease-out; }
    .animate-float { animation: float 3s ease-in-out infinite; }
    .animate-gradient { 
      animation: gradient 15s ease infinite;
      background-size: 200% 200%;
    }
    .animate-spin { animation: spin 1s linear infinite; }
    
    /* Custom Classes */
    .glass-effect {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.92);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
    
    .progress-bar {
      transition: width 0.5s ease-in-out;
    }
    
    .star-bg {
      background: radial-gradient(circle at 20% 80%, rgba(255,215,0,0.1) 0%, transparent 50%),
                  radial-gradient(circle at 80% 20%, rgba(255,215,0,0.1) 0%, transparent 50%),
                  radial-gradient(circle at 40% 40%, rgba(79, 70, 229, 0.05) 0%, transparent 50%);
    }
    
    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--secondary);
    }
    
    /* Focus Styles */
    button:focus, 
    input:focus,
    select:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }
    
    /* Selection */
    ::selection {
      background-color: rgba(79, 70, 229, 0.3);
      color: white;
    }
  </style>
  
  <!-- View Transitions API -->
  <style>
    @view-transition { navigation: auto; }
    
    @media (prefers-reduced-motion: reduce) {
      *, ::before, ::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>

<body class="h-full bg-gradient-to-br from-indigo-900 via-purple-900 to-indigo-800 star-bg overflow-auto animate-gradient">
  <!-- Loading Screen -->
  <div id="loadingScreen" class="fixed inset-0 bg-indigo-900 flex flex-col items-center justify-center z-50 transition-opacity duration-300">
    <div class="animate-spin text-6xl mb-6">ğŸ“š</div>
    <p class="text-white text-xl">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©...</p>
    <div class="mt-4 w-64 h-2 bg-indigo-800 rounded-full overflow-hidden">
      <div id="loadingBar" class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 transition-all duration-300" style="width: 0%"></div>
    </div>
  </div>

  <!-- Main App -->
  <div id="app" class="w-full min-h-full flex flex-col hidden">
    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø«Ø§Ø¨Øª -->
    <header class="bg-white/95 border-b-4 border-indigo-600 shadow-xl sticky top-0 z-40">
      <div class="container-fluid mx-auto px-4 md:px-6 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="text-4xl animate-float" role="img" aria-label="ÙƒØªØ§Ø¨ ØªØ¹Ù„ÙŠÙ…ÙŠ">
              ğŸ“š
            </div>
            <div>
              <h1 id="headerTitle" class="text-xl md:text-2xl font-extrabold text-indigo-900">Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ù„Ù ÙÙŠ Ø§Ù„Ø£ÙØ¹Ø§Ù„</h1>
              <p class="text-xs text-indigo-600">ØªØ¹Ù„Ù… Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø¨Ø·Ø±ÙŠÙ‚Ø© ØªÙØ§Ø¹Ù„ÙŠØ©</p>
            </div>
          </div>
          <div class="flex items-center gap-4">
            <button id="soundToggle" class="p-2 rounded-full hover:bg-gray-100 transition-colors" aria-label="ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª">
              <span id="soundIcon" class="text-2xl">ğŸ”Š</span>
            </button>
            <div class="text-3xl" role="img" aria-label="Ù†Ø¬ÙˆÙ…">
              âœ¨
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <main class="flex-1 p-4 md:p-6 overflow-auto">
      <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
      <div id="startScreen" class="flex flex-col items-center justify-center min-h-full animate-slide-in">
        <div class="glass-effect rounded-3xl p-8 md:p-12 max-w-2xl w-full text-center shadow-2xl card-hover">
          <div class="text-6xl mb-6 animate-float" role="img" aria-label="ÙƒØªØ§Ø¨ Ù…ÙØªÙˆØ­">
            ğŸ“š
          </div>
          <h1 id="gameTitle" class="text-3xl md:text-4xl font-extrabold text-indigo-900 mb-4">Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ù„Ù ÙÙŠ Ø§Ù„Ø£ÙØ¹Ø§Ù„</h1>
          <p class="text-gray-600 mb-8 text-lg">Ø§Ø®ØªØ¨Ø± Ù…Ø¹Ø±ÙØªÙƒ Ø¨Ù‚ÙˆØ§Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£Ù„Ù ÙÙŠ Ø¢Ø®Ø± Ø§Ù„Ø£ÙØ¹Ø§Ù„</p>
          
          <div class="bg-indigo-50 rounded-2xl p-6 mb-8 text-right border border-indigo-100">
            <h3 class="font-bold text-indigo-800 mb-3 text-lg flex items-center gap-2">
              <span>ğŸ“–</span>
              <span>ØªØ°ÙƒÙ‘Ø± Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©:</span>
            </h3>
            <ul class="text-gray-700 space-y-3 text-sm">
              <li class="flex items-start gap-2">
                <span class="text-indigo-600 font-bold mt-1">â€¢</span>
                <div>
                  <strong>Ø§Ù„Ø£Ù„Ù Ø§Ù„Ù…Ù…Ø¯ÙˆØ¯Ø© (Ø§):</strong> Ø¥Ø°Ø§ ÙƒØ§Ù† Ø£ØµÙ„Ù‡Ø§ <span class="text-indigo-600 font-bold">ÙˆØ§Ùˆ</span> ÙÙŠ Ø§Ù„Ù…Ø¶Ø§Ø±Ø¹
                  <p class="text-xs text-gray-500 mt-1">Ù…Ø«Ø§Ù„: Ø¯Ù†Ø§ â† ÙŠÙØ¯Ù’Ù†ÙÙˆ (Ø¨ÙˆØ§Ùˆ)</p>
                </div>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-purple-600 font-bold mt-1">â€¢</span>
                <div>
                  <strong>Ø§Ù„Ø£Ù„Ù Ø§Ù„Ù…Ù‚ØµÙˆØ±Ø© (Ù‰):</strong> Ø¥Ø°Ø§ ÙƒØ§Ù† Ø£ØµÙ„Ù‡Ø§ <span class="text-purple-600 font-bold">ÙŠØ§Ø¡</span> ÙÙŠ Ø§Ù„Ù…Ø¶Ø§Ø±Ø¹
                  <p class="text-xs text-gray-500 mt-1">Ù…Ø«Ø§Ù„: Ù‚Ø¶Ù‰ â† ÙŠÙÙ‚Ù’Ø¶ÙÙŠ (Ø¨Ù€ÙŠØ§Ø¡)</p>
                </div>
              </li>
            </ul>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <button onclick="startGame('practice')" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-xl font-bold py-6 px-6 rounded-2xl hover:from-indigo-700 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1 card-hover flex flex-col items-center">
              <div class="text-3xl mb-2" role="img" aria-label="Ù‚Ù„Ù…">
                âœï¸
              </div>
              <div class="font-bold">
                Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ÙŠ
              </div>
              <div class="text-xs mt-1 opacity-80">
                Ø§Ø®ØªØ¨Ø± ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£ÙØ¹Ø§Ù„
              </div>
              <div class="mt-2 text-xs text-indigo-200">
                (10 Ø£Ø³Ø¦Ù„Ø©)
              </div>
            </button>
            
            <button onclick="startGame('theory')" class="bg-gradient-to-r from-emerald-600 to-teal-600 text-white text-xl font-bold py-6 px-6 rounded-2xl hover:from-emerald-700 hover:to-teal-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1 card-hover flex flex-col items-center">
              <div class="text-3xl mb-2" role="img" aria-label="ÙƒØªØ§Ø¨">
                ğŸ“–
              </div>
              <div class="font-bold">
                Ù‚ÙŠØ§Ø³ Ø­ÙØ¸ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯
              </div>
              <div class="text-xs mt-1 opacity-80">
                ØµØ­ ÙˆØ®Ø·Ø£ ÙˆØ§Ø®ØªÙŠØ§Ø±Ø§Øª
              </div>
              <div class="mt-2 text-xs text-emerald-200">
                (10 Ø£Ø³Ø¦Ù„Ø©)
              </div>
            </button>
          </div>
          
          <!-- Stats Summary -->
          <div id="statsSummary" class="mt-8 bg-gradient-to-r from-gray-50 to-gray-100 rounded-2xl p-4 text-center hidden">
            <h4 class="font-bold text-gray-700 mb-2">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h4>
            <div class="grid grid-cols-3 gap-2">
              <div class="text-center">
                <div id="bestScore" class="text-2xl font-bold text-indigo-600">0</div>
                <div class="text-xs text-gray-500">Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©</div>
              </div>
              <div class="text-center">
                <div id="totalGames" class="text-2xl font-bold text-emerald-600">0</div>
                <div class="text-xs text-gray-500">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</div>
              </div>
              <div class="text-center">
                <div id="avgAccuracy" class="text-2xl font-bold text-purple-600">0%</div>
                <div class="text-xs text-gray-500">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯Ù‚Ø©</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© -->
      <div id="gameScreen" class="hidden min-h-full flex flex-col">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª -->
        <div class="glass-effect rounded-2xl p-4 mb-6 flex justify-between items-center shadow-lg">
          <div class="flex items-center gap-2">
            <span class="text-2xl" role="img" aria-label="Ù†Ø¬Ù…Ø©">â­</span>
            <div>
              <span id="score" class="text-2xl font-bold text-indigo-900">0</span>
              <span class="text-sm text-gray-600 mr-2">Ù†Ù‚Ø·Ø©</span>
            </div>
          </div>
          
          <div class="flex items-center gap-2">
            <span class="text-gray-600">Ø§Ù„Ø³Ø¤Ø§Ù„</span>
            <span id="questionNum" class="bg-indigo-600 text-white px-3 py-1 rounded-full font-bold">1/10</span>
          </div>
          
          <div class="flex items-center gap-2">
            <span id="streak" class="text-2xl" role="img" aria-label="Ø³Ù„Ø³Ù„Ø© Ù†Ø¬Ø§Ø­">ğŸ”¥</span>
            <div>
              <span id="streakCount" class="font-bold text-orange-600">0</span>
              <span class="text-sm text-gray-600 mr-2">Ø³Ù„Ø³Ù„Ø©</span>
            </div>
          </div>
        </div>

        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 rounded-full h-2 mb-6 overflow-hidden">
          <div id="progressBar" class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 progress-bar" style="width: 10%"></div>
        </div>

        <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ -->
        <div id="questionCard" class="glass-effect rounded-3xl p-6 md:p-8 flex-1 flex flex-col shadow-2xl animate-slide-in">
          <!-- Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„ -->
          <div id="questionType" class="text-center mb-6">
            <span class="bg-indigo-100 text-indigo-800 px-4 py-2 rounded-full text-sm font-bold">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</span>
          </div>

          <!-- Ø§Ù„Ø³Ø¤Ø§Ù„ -->
          <div class="flex-1 flex flex-col items-center justify-center">
            <p id="questionText" class="text-2xl md:text-3xl font-bold text-gray-800 text-center mb-8 leading-relaxed"></p>
            
            <!-- Ø§Ù„ÙØ¹Ù„ Ø§Ù„Ù…Ø¶Ø§Ø±Ø¹ ÙƒØªÙ„Ù…ÙŠØ­ -->
            <div id="hintBox" class="hidden bg-amber-50 border-2 border-amber-200 rounded-xl p-4 mb-6 text-center animate-slide-in">
              <span class="text-amber-700 text-sm flex items-center justify-center gap-2">
                <span role="img" aria-label="ØªÙ„Ù…ÙŠØ­">ğŸ’¡</span>
                <span>ØªÙ„Ù…ÙŠØ­: Ø§Ù„Ù…Ø¶Ø§Ø±Ø¹ Ù‡Ùˆ</span>
                <span id="hintVerb" class="font-bold text-amber-800 text-lg"></span>
              </span>
            </div>

            <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© -->
            <div id="optionsContainer" class="w-full max-w-md space-y-3"></div>
          </div>

          <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
          <div id="feedbackBox" class="hidden mt-6 p-4 rounded-2xl text-center animate-slide-in">
            <div class="flex items-center justify-center gap-2 mb-2">
              <span id="feedbackIcon" class="text-2xl">âœ…</span>
              <p id="feedbackText" class="text-lg font-bold"></p>
            </div>
            <p id="feedbackExplanation" class="text-sm"></p>
          </div>

          <!-- Ø²Ø± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© -->
          <div class="mt-6">
            <button id="nextBtn" onclick="nextQuestion()" class="hidden w-full bg-gradient-to-r from-emerald-500 to-teal-500 text-white text-xl font-bold py-4 rounded-2xl hover:from-emerald-600 hover:to-teal-600 transition-all duration-300 shadow-lg hover:shadow-xl">
              <span id="nextBtnText">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ</span>
              <span id="nextIcon" class="mr-2">â†</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
      <div id="resultScreen" class="hidden min-h-full flex items-center justify-center">
        <div class="glass-effect rounded-3xl p-8 md:p-12 max-w-lg w-full text-center shadow-2xl animate-slide-in">
          <div id="resultEmoji" class="text-8xl mb-6 animate-celebrate" role="img" aria-label="Ù†ØªÙŠØ¬Ø©">
            ğŸ†
          </div>
          
          <h2 class="text-3xl font-extrabold text-indigo-900 mb-4">Ø£Ø­Ø³Ù†Øª!</h2>
          <p id="resultMessage" class="text-gray-600 mb-6 text-lg"></p>
          
          <div class="bg-gradient-to-r from-indigo-100 to-purple-100 rounded-2xl p-6 mb-8 border border-indigo-200">
            <div class="text-5xl font-extrabold text-indigo-900 mb-2">
              <span id="finalScore">0</span>/<span id="totalQuestions">10</span>
            </div>
            <p class="text-gray-600">Ø¥Ø¬Ø§Ø¨Ø§Øª ØµØ­ÙŠØ­Ø©</p>
            
            <div class="mt-4 grid grid-cols-3 gap-4">
              <div class="text-center">
                <div id="accuracy" class="text-2xl font-bold text-emerald-600">0%</div>
                <div class="text-xs text-gray-500">Ø§Ù„Ø¯Ù‚Ø©</div>
              </div>
              <div class="text-center">
                <div id="timeSpent" class="text-2xl font-bold text-indigo-600">0s</div>
                <div class="text-xs text-gray-500">Ø§Ù„Ø²Ù…Ù†</div>
              </div>
              <div class="text-center">
                <div id="maxStreak" class="text-2xl font-bold text-orange-600">0</div>
                <div class="text-xs text-gray-500">Ø£ÙØ¶Ù„ Ø³Ù„Ø³Ù„Ø© ğŸ”¥</div>
              </div>
            </div>
            
            <!-- Chart-like Progress -->
            <div class="mt-6 space-y-2">
              <div class="flex justify-between text-sm text-gray-600">
                <span>Ø§Ù„ØªÙ‚Ø¯Ù…</span>
                <span id="progressPercent">0%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                <div id="resultProgress" class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 progress-bar" style="width: 0%"></div>
              </div>
            </div>
          </div>

          <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ -->
          <div id="mistakesSummary" class="hidden bg-gradient-to-r from-red-50 to-orange-50 rounded-2xl p-4 mb-6 text-right border border-red-100">
            <h4 class="font-bold text-red-800 mb-3 flex items-center gap-2">
              <span role="img" aria-label="Ù‚Ù„Ù… Ù„Ù„ØªØµØ­ÙŠØ­">ğŸ“</span>
              <span>Ø±Ø§Ø¬Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ø£ÙØ¹Ø§Ù„:</span>
            </h4>
            <ul id="mistakesList" class="text-sm text-red-700 space-y-2 max-h-40 overflow-y-auto pr-2"></ul>
            <button onclick="retryMistakes()" class="mt-3 w-full bg-gradient-to-r from-red-500 to-orange-500 text-white py-2 px-4 rounded-lg hover:from-red-600 hover:to-orange-600 transition-all duration-300 text-sm">
              ğŸ¯ ØªØ¯Ø±Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙ‚Ø·
            </button>
          </div>

          <!-- Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨ -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <button onclick="restartGame()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-xl font-bold py-4 px-8 rounded-2xl hover:from-indigo-700 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl">
              <span class="flex items-center justify-center gap-2">
                <span>ğŸ”„</span>
                <span>Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</span>
              </span>
            </button>
            
            <button onclick="goToStart()" class="w-full bg-gradient-to-r from-gray-600 to-gray-700 text-white text-xl font-bold py-4 px-8 rounded-2xl hover:from-gray-700 hover:to-gray-800 transition-all duration-300 shadow-lg">
              <span class="flex items-center justify-center gap-2">
                <span>ğŸ </span>
                <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
              </span>
            </button>
          </div>
        </div>
      </div>
    </main>

    <!-- Ø§Ù„ÙÙˆØªØ± Ø§Ù„Ø«Ø§Ø¨Øª -->
    <footer class="bg-white/95 border-t-4 border-indigo-600 shadow-xl mt-auto">
      <div class="container-fluid mx-auto px-4 md:px-6 py-4">
        <div class="text-center">
          <p class="text-indigo-900 font-bold text-sm md:text-base mb-1">Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ</p>
          <p class="text-indigo-700 text-xs md:text-sm">Ù…Ø¹Ù„Ù… Ù…Ø¬Ø§Ù„ Ø£ÙˆÙ„ - Ù…Ø¯Ø±Ø³Ø© Ø³Ø¹Ø¯ Ø¨Ù† Ù…Ø¹Ø§Ø° Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</p>
          <p class="text-gray-500 text-xs mt-2">Â© 2024 - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
        </div>
      </div>
    </footer>
  </div>

  <!-- JavaScript Ø§Ù„Ù…Ø­Ø³Ù† -->
  <script>
    // ===========================================
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    // ===========================================
    const allQuestions = [
      // Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯ - Ø§Ø®ØªØ± Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
      { 
        type: 'choose', 
        verb: 'Ø¯Ù†Ø§', 
        present: 'ÙŠØ¯Ù†Ùˆ', 
        correct: 'Ø¯Ù†Ø§', 
        wrong: 'Ø¯Ù†Ù‰', 
        origin: 'ÙˆØ§Ùˆ', 
        explanation: 'ØµØ­ÙŠØ­! Ù„Ø£Ù† Ø§Ù„ÙØ¹Ù„ Ø§Ù„Ù…Ø¶Ø§Ø±Ø¹ "ÙŠÙØ¯Ù’Ù†ÙÙˆ" ÙŠÙ†ØªÙ‡ÙŠ Ø¨ÙˆØ§ÙˆØŒ Ù„Ø°Ù„Ùƒ ØªÙÙƒØªØ¨ Ø§Ù„Ø£Ù„Ù ÙÙŠ Ø§Ù„Ù…Ø§Ø¶ÙŠ Ù…Ù…Ø¯ÙˆØ¯Ø© (Ø§)',
        difficulty: 'easy'
      },
      { 
        type: 'choose', 
        verb: 'Ø³Ù…Ø§', 
        present: 'ÙŠØ³Ù…Ùˆ', 
        correct: 'Ø³Ù…Ø§', 
        wrong: 'Ø³Ù…Ù‰', 
        origin: 'ÙˆØ§Ùˆ', 
        explanation: 'Ø£Ø­Ø³Ù†Øª! Ø§Ù„Ù…Ø¶Ø§Ø±Ø¹ "ÙŠÙØ³Ù’Ù…ÙÙˆ" ÙŠÙ†ØªÙ‡ÙŠ Ø¨ÙˆØ§ÙˆØŒ Ù„Ø°Ù„Ùƒ Ø§Ù„Ù…Ø§Ø¶ÙŠ "Ø³Ù…Ø§" Ø¨Ø£Ù„Ù Ù…Ù…Ø¯ÙˆØ¯Ø©',
        difficulty: 'easy'
      },
      // ... (Ø¥Ø¨Ù‚Ø§Ø¡ Ø¨Ù‚ÙŠØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙƒÙ…Ø§ Ù‡ÙŠ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© explanation Ù…ÙØµÙ„Ø©)
    ];

    const theoryQuestions = [
      // ... (Ø¥Ø¨Ù‚Ø§Ø¡ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù†Ø¸Ø±ÙŠØ© ÙƒÙ…Ø§ Ù‡ÙŠ)
    ];

    // ===========================================
    // Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
    // ===========================================
    let gameState = {
      questions: [],
      currentQuestion: 0,
      score: 0,
      streak: 0,
      maxStreak: 0,
      mistakes: [],
      answered: false,
      gameMode: 'practice',
      startTime: null,
      endTime: null,
      soundsEnabled: true,
      stats: {
        totalGames: 0,
        bestScore: 0,
        totalCorrect: 0,
        totalQuestions: 0
      }
    };

    // ===========================================
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
    // ===========================================
    const defaultConfig = {
      game_title: 'Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ù„Ù ÙÙŠ Ø§Ù„Ø£ÙØ¹Ø§Ù„',
      primary_color: '#4f46e5',
      secondary_color: '#7c3aed',
      background_color: '#312e81',
      text_color: '#1e1b4b',
      accent_color: '#f59e0b'
    };

    let config = { ...defaultConfig };

    // ===========================================
    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
    // ===========================================
    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    function playSound(type) {
      if (!gameState.soundsEnabled) return;
      
      const sounds = {
        click: () => new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQ='),
        correct: () => {
          const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQ=');
          audio.volume = 0.3;
          return audio;
        },
        wrong: () => {
          const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQ=');
          audio.volume = 0.3;
          return audio;
        },
        win: () => {
          const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQ=');
          audio.volume = 0.4;
          return audio;
        }
      };
      
      try {
        const audio = sounds[type]?.();
        if (audio) {
          audio.play().catch(() => {});
        }
      } catch (error) {
        console.log('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:', error);
      }
    }

    function saveStats() {
      try {
        localStorage.setItem('arabicGame_stats', JSON.stringify(gameState.stats));
      } catch (error) {
        console.log('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­ÙØ¸ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
      }
    }

    function loadStats() {
      try {
        const saved = localStorage.getItem('arabicGame_stats');
        if (saved) {
          gameState.stats = { ...gameState.stats, ...JSON.parse(saved) };
          updateStatsDisplay();
        }
      } catch (error) {
        console.log('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
      }
    }

    function updateStatsDisplay() {
      const { totalGames, bestScore, totalCorrect, totalQuestions } = gameState.stats;
      const avgAccuracy = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
      
      document.getElementById('bestScore').textContent = bestScore;
      document.getElementById('totalGames').textContent = totalGames;
      document.getElementById('avgAccuracy').textContent = `${avgAccuracy}%`;
      
      if (totalGames > 0) {
        document.getElementById('statsSummary').classList.remove('hidden');
      }
    }

    // ===========================================
    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    // ===========================================
    async function startGame(mode = 'practice') {
      playSound('click');
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
      document.getElementById('loadingScreen').classList.remove('hidden');
      
      // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
      let progress = 0;
      const loadingBar = document.getElementById('loadingBar');
      const interval = setInterval(() => {
        progress += Math.random() * 20;
        if (progress > 100) progress = 100;
        loadingBar.style.width = `${progress}%`;
        
        if (progress >= 100) {
          clearInterval(interval);
          setTimeout(() => {
            document.getElementById('loadingScreen').classList.add('hidden');
            initializeGame(mode);
          }, 300);
        }
      }, 100);
    }

    function initializeGame(mode) {
      gameState.gameMode = mode;
      gameState.startTime = Date.now();
      
      if (mode === 'theory') {
        gameState.questions = shuffleArray(theoryQuestions).slice(0, 10);
      } else {
        gameState.questions = shuffleArray(allQuestions).slice(0, 10);
      }
      
      gameState.currentQuestion = 0;
      gameState.score = 0;
      gameState.streak = 0;
      gameState.maxStreak = 0;
      gameState.mistakes = [];
      gameState.answered = false;
      
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('resultScreen').classList.add('hidden');
      document.getElementById('gameScreen').classList.remove('hidden');
      document.getElementById('app').classList.remove('hidden');
      
      showQuestion();
    }

    function showQuestion() {
      gameState.answered = false;
      const q = gameState.questions[gameState.currentQuestion];
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ±
      const questionCard = document.getElementById('questionCard');
      questionCard.classList.remove('animate-slide-in');
      void questionCard.offsetWidth;
      questionCard.classList.add('animate-slide-in');
      
      document.getElementById('questionNum').textContent = `${gameState.currentQuestion + 1}/10`;
      document.getElementById('score').textContent = gameState.score;
      document.getElementById('streakCount').textContent = gameState.streak;
      
      // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
      const progressPercent = ((gameState.currentQuestion) / 10) * 100;
      document.getElementById('progressBar').style.width = `${progressPercent}%`;
      
      document.getElementById('feedbackBox').classList.add('hidden');
      document.getElementById('nextBtn').classList.add('hidden');
      document.getElementById('hintBox').classList.add('hidden');
      
      const optionsContainer = document.getElementById('optionsContainer');
      optionsContainer.innerHTML = '';
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
      switch (q.type) {
        case 'truefalse':
          setupTrueFalseQuestion(q);
          break;
        case 'mcq':
          setupMCQQuestion(q);
          break;
        case 'choose':
          setupChooseQuestion(q);
          break;
        case 'origin':
          setupOriginQuestion(q);
          break;
        case 'fill':
          setupFillQuestion(q);
          break;
      }
    }

    function setupTrueFalseQuestion(q) {
      document.getElementById('questionType').innerHTML = 
        '<span class="bg-emerald-100 text-emerald-800 px-4 py-2 rounded-full text-sm font-bold">âœ“ ØµØ­ Ø£Ùˆ Ø®Ø·Ø£</span>';
      document.getElementById('questionText').textContent = q.question;
      
      ['âœ“ ØµØ­', 'âœ— Ø®Ø·Ø£'].forEach((opt, index) => {
        const isTrue = index === 0;
        const btn = createOptionButton(opt, () => checkAnswer(isTrue, q.correct, q));
        optionsContainer.appendChild(btn);
      });
    }

    function setupMCQQuestion(q) {
      document.getElementById('questionType').innerHTML = 
        '<span class="bg-teal-100 text-teal-800 px-4 py-2 rounded-full text-sm font-bold">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</span>';
      document.getElementById('questionText').textContent = q.question;
      
      q.options.forEach((opt, index) => {
        const btn = createOptionButton(opt, () => checkAnswer(index, q.correct, q));
        optionsContainer.appendChild(btn);
      });
    }

    function setupChooseQuestion(q) {
      document.getElementById('questionType').innerHTML = 
        '<span class="bg-indigo-100 text-indigo-800 px-4 py-2 rounded-full text-sm font-bold">Ø§Ø®ØªØ± Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</span>';
      document.getElementById('questionText').innerHTML = 
        `Ù…Ø§ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ù„ÙØ¹Ù„ Ø§Ù„Ù…Ø§Ø¶ÙŠ Ù…Ù† "<span class="text-indigo-600">${q.present}</span>"ØŸ`;
      
      const options = shuffleArray([q.correct, q.wrong]);
      options.forEach(opt => {
        const btn = createOptionButton(opt, () => checkAnswer(opt, q.correct, q));
        optionsContainer.appendChild(btn);
      });
    }

    function setupOriginQuestion(q) {
      document.getElementById('questionType').innerHTML = 
        '<span class="bg-purple-100 text-purple-800 px-4 py-2 rounded-full text-sm font-bold">Ø­Ø¯Ø¯ Ø£ØµÙ„ Ø§Ù„Ø£Ù„Ù</span>';
      document.getElementById('questionText').textContent = `Ù…Ø§ Ø£ØµÙ„ Ø§Ù„Ø£Ù„Ù ÙÙŠ Ø§Ù„ÙØ¹Ù„ "${q.verb}"ØŸ`;
      
      document.getElementById('hintBox').classList.remove('hidden');
      document.getElementById('hintVerb').textContent = q.present;
      
      ['ğŸ”µ ÙˆØ§Ùˆ (Ø§)', 'ğŸŸ£ ÙŠØ§Ø¡ (Ù‰)'].forEach(opt => {
        const btn = createOptionButton(opt, () => {
          const answer = opt.includes('ÙˆØ§Ùˆ') ? 'ÙˆØ§Ùˆ' : 'ÙŠØ§Ø¡';
          checkAnswer(answer, q.correct, q);
        });
        optionsContainer.appendChild(btn);
      });
    }

    function setupFillQuestion(q) {
      document.getElementById('questionType').innerHTML = 
        '<span class="bg-emerald-100 text-emerald-800 px-4 py-2 rounded-full text-sm font-bold">Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¬Ù…Ù„Ø©</span>';
      document.getElementById('questionText').innerHTML = 
        `Ø£ÙƒÙ…Ù„: <span class="text-indigo-600">"${q.sentence}"</span>`;
      
      const options = shuffleArray([q.correct, q.wrong]);
      options.forEach(opt => {
        const btn = createOptionButton(opt, () => checkAnswer(opt, q.correct, q));
        optionsContainer.appendChild(btn);
      });
    }

    function createOptionButton(text, onClick) {
      const btn = document.createElement('button');
      btn.className = 'w-full bg-white border-2 border-gray-200 text-gray-800 text-xl font-bold py-4 px-6 rounded-2xl hover:border-indigo-400 hover:bg-indigo-50 transition-all duration-200 card-hover';
      btn.textContent = text;
      btn.onclick = () => {
        playSound('click');
        onClick();
      };
      btn.setAttribute('aria-label', `Ø®ÙŠØ§Ø±: ${text}`);
      return btn;
    }

    function checkAnswer(selected, correct, q) {
      if (gameState.answered) return;
      gameState.answered = true;
      
      const buttons = document.querySelectorAll('#optionsContainer button');
      let isCorrect = false;
      
      // ØªØ­Ø¯ÙŠØ¯ ØµØ­Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„
      switch (q.type) {
        case 'truefalse':
          isCorrect = selected === correct;
          break;
        case 'mcq':
          isCorrect = selected === correct;
          break;
        case 'choose':
        case 'fill':
          isCorrect = selected === correct;
          break;
        case 'origin':
          isCorrect = selected === correct;
          break;
      }
      
      // ØªØ­Ø¯ÙŠØ« Ù…Ø¸Ù‡Ø± Ø§Ù„Ø£Ø²Ø±Ø§Ø±
      buttons.forEach((btn, index) => {
        btn.disabled = true;
        let isThisCorrect = false;
        
        switch (q.type) {
          case 'truefalse':
            isThisCorrect = (btn.textContent.includes('ØµØ­') && correct === true) || 
                           (btn.textContent.includes('Ø®Ø·Ø£') && correct === false);
            break;
          case 'mcq':
            isThisCorrect = index === correct;
            break;
          default:
            isThisCorrect = btn.textContent === correct || 
                           btn.textContent.includes(correct);
        }
        
        if (isThisCorrect) {
          btn.className = 'w-full bg-emerald-500 border-2 border-emerald-600 text-white text-xl font-bold py-4 px-6 rounded-2xl animate-pulse-custom';
        } else if ((btn.textContent === selected?.toString() || btn.textContent.includes(selected?.toString() || '')) && !isCorrect) {
          btn.className = 'w-full bg-red-500 border-2 border-red-600 text-white text-xl font-bold py-4 px-6 rounded-2xl animate-shake';
        }
      });
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
      showFeedback(isCorrect, q);
    }

    function showFeedback(isCorrect, q) {
      const feedbackBox = document.getElementById('feedbackBox');
      const feedbackText = document.getElementById('feedbackText');
      const feedbackExplanation = document.getElementById('feedbackExplanation');
      const feedbackIcon = document.getElementById('feedbackIcon');
      
      if (isCorrect) {
        gameState.score++;
        gameState.streak++;
        if (gameState.streak > gameState.maxStreak) gameState.maxStreak = gameState.streak;
        
        playSound('correct');
        
        feedbackBox.className = 'mt-6 p-4 rounded-2xl text-center bg-emerald-100 border-2 border-emerald-300 animate-slide-in';
        feedbackIcon.textContent = gameState.streak >= 3 ? 'ğŸ”¥' : 'âœ…';
        feedbackText.className = 'text-lg font-bold mb-2 text-emerald-800';
        feedbackText.textContent = gameState.streak >= 3 ? 
          `ğŸ”¥ Ø±Ø§Ø¦Ø¹! Ø³Ù„Ø³Ù„Ø© ${gameState.streak} Ø¥Ø¬Ø§Ø¨Ø§Øª ØµØ­ÙŠØ­Ø©!` : 
          'âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!';
      } else {
        gameState.streak = 0;
        playSound('wrong');
        
        if (q.verb) {
          gameState.mistakes.push({ 
            verb: q.verb, 
            correct: q.correct, 
            present: q.present,
            question: q 
          });
        } else {
          gameState.mistakes.push({ 
            verb: q.question, 
            correct: 'Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø´Ø±Ø­', 
            present: '',
            question: q
          });
        }
        
        feedbackBox.className = 'mt-6 p-4 rounded-2xl text-center bg-red-100 border-2 border-red-300 animate-slide-in';
        feedbackIcon.textContent = 'âŒ';
        feedbackText.className = 'text-lg font-bold mb-2 text-red-800';
        feedbackText.textContent = 'Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©';
      }
      
      feedbackExplanation.textContent = q.explanation;
      feedbackBox.classList.remove('hidden');
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙˆØ§Ù„Ø³Ù„Ø³Ù„Ø©
      document.getElementById('score').textContent = gameState.score;
      document.getElementById('score').classList.add('animate-pulse-custom');
      setTimeout(() => document.getElementById('score').classList.remove('animate-pulse-custom'), 300);
      
      document.getElementById('streakCount').textContent = gameState.streak;
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
      const nextBtn = document.getElementById('nextBtn');
      const nextBtnText = document.getElementById('nextBtnText');
      const nextIcon = document.getElementById('nextIcon');
      
      if (gameState.currentQuestion < 9) {
        nextBtnText.textContent = 'Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ';
        nextIcon.textContent = 'â†';
      } else {
        nextBtnText.textContent = 'Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬';
        nextIcon.textContent = 'ğŸ†';
      }
      
      nextBtn.classList.remove('hidden');
    }

    function nextQuestion() {
      playSound('click');
      gameState.currentQuestion++;
      
      if (gameState.currentQuestion < 10) {
        showQuestion();
      } else {
        endGame();
      }
    }

    function endGame() {
      gameState.endTime = Date.now();
      const timeSpent = Math.round((gameState.endTime - gameState.startTime) / 1000);
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      gameState.stats.totalGames++;
      gameState.stats.totalCorrect += gameState.score;
      gameState.stats.totalQuestions += 10;
      if (gameState.score > gameState.stats.bestScore) {
        gameState.stats.bestScore = gameState.score;
      }
      saveStats();
      
      // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
      document.getElementById('gameScreen').classList.add('hidden');
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      document.getElementById('resultScreen').classList.remove('hidden');
      
      const percentage = (gameState.score / 10) * 100;
      const resultEmoji = document.getElementById('resultEmoji');
      const resultMessage = document.getElementById('resultMessage');
      
      // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø©
      if (percentage === 100) {
        resultEmoji.textContent = 'ğŸ‘‘';
        resultMessage.textContent = 'Ù…Ù…ØªØ§Ø²! Ø£Ù†Øª Ù…ØªÙ‚Ù† Ù„Ù‚ÙˆØ§Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£Ù„Ù ÙÙŠ Ø§Ù„Ø£ÙØ¹Ø§Ù„!';
        playSound('win');
      } else if (percentage >= 80) {
        resultEmoji.textContent = 'ğŸŒŸ';
        resultMessage.textContent = 'Ø£Ø­Ø³Ù†Øª! Ø£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹ØŒ ÙˆØ§ØµÙ„ Ø§Ù„ØªØ¹Ù„Ù…!';
        playSound('win');
      } else if (percentage >= 60) {
        resultEmoji.textContent = 'ğŸ‘';
        resultMessage.textContent = 'Ø¬ÙŠØ¯! ØªØ­ØªØ§Ø¬ Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨Ø¹Ø¶ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯.';
      } else if (percentage >= 40) {
        resultEmoji.textContent = 'ğŸ“š';
        resultMessage.textContent = 'Ù„Ø§ Ø¨Ø£Ø³ØŒ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!';
      } else {
        resultEmoji.textContent = 'ğŸ’ª';
        resultMessage.textContent = 'ØªØ­ØªØ§Ø¬ Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªØ¯Ø±ÙŠØ¨ØŒ Ù„Ø§ ØªØ³ØªØ³Ù„Ù…!';
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
      document.getElementById('finalScore').textContent = gameState.score;
      document.getElementById('totalQuestions').textContent = 10;
      document.getElementById('accuracy').textContent = `${Math.round(percentage)}%`;
      document.getElementById('maxStreak').textContent = gameState.maxStreak;
      document.getElementById('timeSpent').textContent = `${timeSpent} Ø«Ø§Ù†ÙŠØ©`;
      
      // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
      document.getElementById('progressPercent').textContent = `${Math.round(percentage)}%`;
      document.getElementById('resultProgress').style.width = `${percentage}%`;
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¥Ù† ÙˆØ¬Ø¯Øª
      const mistakesSummary = document.getElementById('mistakesSummary');
      const mistakesList = document.getElementById('mistakesList');
      
      if (gameState.mistakes.length > 0) {
        mistakesSummary.classList.remove('hidden');
        if (gameState.gameMode === 'theory') {
          mistakesList.innerHTML = gameState.mistakes.map((m, index) => 
            `<li class="flex justify-between items-center mb-2 p-2 bg-white/50 rounded-lg">
              <span>${index + 1}. ${m.verb.substring(0, 50)}${m.verb.length > 50 ? '...' : ''}</span>
              <span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded">Ø±Ø§Ø¬Ø¹</span>
            </li>`
          ).join('');
        } else {
          mistakesList.innerHTML = gameState.mistakes.map((m, index) => 
            `<li class="flex justify-between items-center mb-2 p-2 bg-white/50 rounded-lg">
              <div class="text-right">
                <div class="font-medium">${m.verb}</div>
                <div class="text-xs text-gray-600">Ø§Ù„Ù…Ø¶Ø§Ø±Ø¹: ${m.present}</div>
              </div>
              <div class="text-left">
                <div class="text-emerald-600 font-bold">${m.correct}</div>
                <div class="text-xs text-gray-500">Ø§Ù„ØµØ­ÙŠØ­</div>
              </div>
            </li>`
          ).join('');
        }
      } else {
        mistakesSummary.classList.add('hidden');
      }
    }

    function retryMistakes() {
      playSound('click');
      if (gameState.mistakes.length === 0) return;
      
      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªÙŠ Ø£Ø®Ø·Ø£ ÙÙŠÙ‡Ø§ ÙÙ‚Ø·
      gameState.questions = gameState.mistakes.map(m => m.question).slice(0, 10);
      if (gameState.questions.length < 3) {
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ù‚Ù„ÙŠÙ„Ø©ØŒ Ø£Ø¶Ù Ø£Ø³Ø¦Ù„Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
        const extraNeeded = 10 - gameState.questions.length;
        const extraQuestions = shuffleArray(
          gameState.gameMode === 'theory' ? theoryQuestions : allQuestions
        ).slice(0, extraNeeded);
        gameState.questions = [...gameState.questions, ...extraQuestions];
      }
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
      gameState.currentQuestion = 0;
      gameState.score = 0;
      gameState.streak = 0;
      gameState.maxStreak = 0;
      gameState.mistakes = [];
      gameState.answered = false;
      gameState.startTime = Date.now();
      
      document.getElementById('resultScreen').classList.add('hidden');
      document.getElementById('gameScreen').classList.remove('hidden');
      
      showQuestion();
    }

    function restartGame() {
      playSound('click');
      startGame(gameState.gameMode);
    }

    function goToStart() {
      playSound('click');
      document.getElementById('resultScreen').classList.add('hidden');
      document.getElementById('gameScreen').classList.add('hidden');
      document.getElementById('startScreen').classList.remove('hidden');
      updateStatsDisplay();
    }

    // ===========================================
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    // ===========================================
    document.addEventListener('DOMContentLoaded', () => {
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      loadStats();
      
      // ØªÙ‡ÙŠØ¦Ø© Ø²Ø± Ø§Ù„ØµÙˆØª
      document.getElementById('soundToggle').addEventListener('click', () => {
        gameState.soundsEnabled = !gameState.soundsEnabled;
        const soundIcon = document.getElementById('soundIcon');
        soundIcon.textContent = gameState.soundsEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
        playSound('click');
      });
      
      // ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          if (!document.getElementById('startScreen').classList.contains('hidden')) return;
          if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŸ')) {
            goToStart();
          }
        }
        
        if (e.key >= '1' && e.key <= '4' && !gameState.answered) {
          const buttons = document.querySelectorAll('#optionsContainer button');
          const index = parseInt(e.key) - 1;
          if (buttons[index]) {
            buttons[index].click();
          }
        }
      });
      
      // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¯ ØªÙ‡ÙŠØ¦Ø© ÙƒÙ„ Ø´ÙŠØ¡
      setTimeout(() => {
        document.getElementById('loadingScreen').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        updateStatsDisplay();
      }, 1000);
    });

    // ===========================================
    // ØªÙƒØ§Ù…Ù„ SDK
    // ===========================================
    async function onConfigChange(newConfig) {
      const title = newConfig.game_title || defaultConfig.game_title;
      document.getElementById('gameTitle').textContent = title;
      document.getElementById('headerTitle').textContent = title;
      
      config = { ...defaultConfig, ...newConfig };
      
      // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
      applyDynamicStyles();
    }

    function applyDynamicStyles() {
      const root = document.documentElement;
      root.style.setProperty('--primary', config.primary_color);
      root.style.setProperty('--secondary', config.secondary_color);
      root.style.setProperty('--accent', config.accent_color);
    }

    function mapToCapabilities(cfg) {
      return {
        recolorables: ['primary_color', 'secondary_color', 'accent_color'],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(cfg) {
      return new Map([
        ['game_title', cfg.game_title || defaultConfig.game_title],
        ['primary_color', cfg.primary_color || defaultConfig.primary_color],
        ['secondary_color', cfg.secondary_color || defaultConfig.secondary_color],
        ['accent_color', cfg.accent_color || defaultConfig.accent_color]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }
  </script>
</body>
</html>
